# Flags {{{
# https://www.reddit.com/r/zsh/comments/877oty/how_to_improve_shell_loading_times/
PERF=false
# }}}

if [ $PERF = true ]; then
  zmodload zsh/zprof
fi
# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
# if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
#   source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
# fi

### Added by Zinit's installer
ZPLG_HOME=~/.zinit
if [[ ! -f $ZPLG_HOME/bin/zinit.zsh ]]; then
  git clone https://github.com/zdharma/zinit $ZPLG_HOME/bin
  zcompile $ZPLG_HOME/bin/zinit.zsh
fi
source ~/.zinit/bin/zinit.zsh
### End of Zinit installer's chunk

ZPLG_HOME=~/.zinit
if [[ ! -f $ZPLG_HOME/bin/zinit.zsh ]]; then
  git clone https://github.com/zdharma/zinit $ZPLG_HOME/bin
  zcompile $ZPLG_HOME/bin/zinit.zsh
fi
source ~/.zinit/bin/zinit.zsh

ZSH_AUTOSUGGEST_MANUAL_REBIND=1  # make prompt faster
DISABLE_MAGIC_FUNCTIONS=true     # make pasting into terminal faster

#EXPORTS
export PATH="$HOME/.rbenv/bin:$PATH"                                       # Ruby
export FZF_DEFAULT_COMMAND='fd --type f --hidden --follow --exclude .git'  # FZF gitignore
export LANG=pt_BR.UTF-8 						   # Language
export UPDATE_ZSH_DAYS=1 						   # Days to update
export DOTREPO="$HOME/dotfiles"
export NVM_DIR="${HOME}/.nvm"
export NVM_LAZY_LOAD=true

#THEME
ZSH_THEME="powerlevel10k/powerlevel10k"

#POWERLEVEL THEME SETTINGS
POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(ssh context dir vcs)
POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(status root_indicator time)
POWERLEVEL9K_SHOW_RULER=true

#PLUGINS
zinit snippet OMZL::git.zsh

zinit ice depth=1;
zplugin light romkatv/powerlevel10k

zinit ice from"gh-r" as"command"
zinit load junegunn/fzf-bin

zinit light denysdovhan/spaceship-prompt
zinit light lukechilds/zsh-nvm

zinit wait lucid for \
 atinit"ZINIT[COMPINIT_OPTS]=-C; zicompinit; zicdreplay" \
    zdharma/fast-syntax-highlighting \
 blockf \
    zsh-users/zsh-completions \
 atload"!_zsh_autosuggest_start" \
    zsh-users/zsh-autosuggestions

#HISTORY OPTS
HISTFILE=$HOME/.zsh_history
HISTSIZE=100000
SAVEHIST=$HISTSIZE
export HISTFILE=~/.zsh_history
export HISTSIZE=100000
export SAVEHIST=$HISTSIZE
export HISTTIMEFORMAT="[%F %T]"
export HISTIGNORE="&:ls:[bf]g:exit:reset:clear:cd:cd ..:cd..:zh"
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_SAVE_NO_DUPS
setopt HIST_REDUCE_BLANKS
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_FIND_NO_DUPS
setopt HIST_IGNORE_SPACE
setopt SHARE_HISTORY
setopt INC_APPEND_HISTORY

#ALIASES
{%@@ if profile == "elementary" @@%}
alias aptup="sudo apt update && sudo apt upgrade"
alias aptclean="sudo apt autoremove"
{%@@ elif profile == "mac" @@%}
alias macup="sudo softwareupdate -i -a"
alias hbup="brew update && brew upgrade && brew cask upgrade"
alias hbclean= "brew cleanup -n"
alias purge= "sudo purge"
{%@@ endif @@%}
alias jkc="bundle exec jekyll clean"
alias jks="bundle exec Jekyll serve"
alias jkh="bundle exec jekyll serve --host 0.0.0.0"
alias jkp="bundle exec jekyll build --profile"
alias jkd="bundle exec jekyll doctor"
alias bup="bundle update"
alias zinitup="zinit update"
alias omzup="upgrade_oh_my_zsh"
alias zshreload= "source ~/.zshrc"
alias dotdrop="$HOME/dotfiles/dotdrop.sh"
alias dotgit="git -C $DOTREPO"
alias dotsync="dotgit pull && dotgit add -A && dotgit commit && dotgit push; dotdrop install"

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ -f ~/.p10k.zsh ]] && source ~/.p10k.zsh

{%@@ if profile == "elementary" @@%}
if [ $TILIX_ID ] || [ $VTE_VERSION ]; then
        source /etc/profile.d/vte.sh
fi
{%@@ endif @@%}
{%@@ if profile == "mac" @@%}
test -e "${HOME}/.iterm2_shell_integration.zsh" && source "${HOME}/.iterm2_shell_integration.zsh"
{%@@ endif @@%}

if [ $PERF = true ]; then
  zprof
fi
